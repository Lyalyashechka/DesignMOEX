# Московская биржа 
## 1. Тема и целевая аудитория.
### 1.1 Тема.
   Московская биржа является крупнейшим организатором торгов акциями, облигациями и другими активами в России. По [данным](https://bcs-express.ru/novosti-i-analitika/top-10-mirovykh-birzh) на июль 2018г. Мос. биржа занимает 22 из 81 место среди крупнейших бирж мира. 
   
   |MVP|
   |---|
   |1. Отслеживание ситуации на рынке| 
   |2. Осуществление сделки на рынке| 
   |3. Получение своей истории торгов на рынке| 
### 1.2 Целевая аудитория.
**По [данным](https://www.moex.com/ru/members.aspx?tid=1179&sby=4) на январь 2022 года количество уникальных клиентов Мос. Биржи:**  
|Тип аудитории      |Кол-во человек|
|-------------------|------------|
|1. Физические лица | 16 779 069 |
|2. Юридические лица | 20 446 |
|3. Иностранные лица | 23 517 |
|4. Иностранные физические лица | 20 685 |
|5. Иностранные юридические лица|  2 832 |
|6. Клиенты, передавшие свои средства в ДУ| 327 432 |
|7. Всего| 17 150 464|  
  
**Основная целевая аудитория** - физические лица, россияне.  
**Портрет российского инвестора согласно сервису** «[Тинькофф инвестиции](https://vc.ru/tinkoff_invest/216367-tinkoff-investicii-sostavili-portret-rossiyskogo-investora-2020)»:  
   |Пол|%|
   |-------|--|
   |Мужчины        |69 %|
   |Женщины        |31 %|  
     
   |Средний возраст|%| 
   |---------------|--|
   |28-38 лет      |43 %|
   |18-28 лет      |27 %|
   |38-48 лет      |21 %|
   |48+            |9  %|  
   
 
## 2. Рассчет нагрузки. 
### 2.1 Продуктовые метрики.  
   **2.1.1. Месячная аудитория.**  
   Количество людей, совершивших хотя бы одну сделку в месяц: 2 723 661. [(источник)](https://www.moex.com/ru/members.aspx?tid=1179&sby=4)  

   **2.1.2. Примерная ежедневная аудитория.**  
Торговля на бирже осуществляется с помощью брокеров. Для подсчета ежедневной аудиторией воспользуемся [данными брокера втб](https://www.vtb.ru/o-banke/press-centr/novosti-i-press-relizy/2021/04/2021-04-20-obem-sredstv-pod-upravleniem-vtb-kapital-investitsii-v-i-kvartale-vyros-na-107/#) о количестве уникальных пользователей, ежедневно использующих их мобильное приложение ``` По состоянию на апрель 2021 года - 300 000 человек``` и [данными](https://smart-lab.ru/brokers-rating/russia/stat/) о распределении общего объема пользователей, совершивших хотя бы одну сделку, по брокерам:  
  
![image](https://user-images.githubusercontent.com/77728314/167299298-f57c1b43-4b20-4ede-b8e6-bb2c2746ca67.png)  
  
Предположим, что рост активных пользователей приложения ВТБ был согласно этому графику, тогда с апреля по ноябрь он составил ~30% и ежедневная аудитория составляет ``` 300 000 * 1,3 = 390 000 ```.  
Исходя из графика пользователи ВТБ занимают 14% от общего объема пользователей на мосбирже. Тогда ежедневная аудитория мос.биржи примерно равна ```390 000 / 14 * 100 = 2 785 000``` пользователей.  
  
   **2.1.3. Среднее количество действий пользователя по типам в день**  
   +  **Оформление сделки**  
   Согласно [данным](https://www.moex.com/ru/marketdata/#/mode=groups&group=4&collection=3&boardgroup=57&data_type=history&date=2022-01-19&category=main) среднее количество сделок по парам в январе 2022г. ~3 400 000. Это в примерно 2 раза больше чем на [январь 2021 года](https://www.moex.com/ru/marketdata/#/mode=groups&group=4&collection=3&boardgroup=57&data_type=history&date=2022-01-19&category=main),что соответствует росту количества физических лиц, пользующихся сервисом, в 2 раза за год. Тогда среднее количество сделок на пользователя в день - ```3 400 000/ 2 785 000 = 1,22```
   + **Получение истории торгов**  
   Ежедневное количество пользователей биржи 2 785 000, предположим что каждый из них хотя бы раз в среднем сделает запрос на получение 30 своих последних ордеров.  
   + **Отслеживание ситуации на рынке**  
   Возьмем среднее время сессии пользователя с самой популярной биржи цифровых активов binance.com [00:08:48](https://www.similarweb.com/ru/website/binance.com/#overview) (binance - аналогичный сервис, но торговля в нем происходит без участия брокеров). И предположим что пользователь из этого времени 8 минут наблядает за стаканом на самом популярном рынке (исходя из данных в п 2.1.3. такой рынок - SBER с 500 000 сделок за торговый день). Сделаем рассчет количества сделок, информацию о которых пользователя получет за указанное время:  
   ```
 500 000 / 17 / 60 * 8 = 3 921 (17 - количество рабочих часов биржи в сутки)
   ```
   |Тип действия | Количество в день| 
   |-------------|------------------|
   |Оформление сделки| 1.22|
   |Получение истории торгов| 1|
   |Отслеживание ситуации на рынке|3 921|  
   
   **2.1.4. Средний размер хранилища пользователя**   
   Биржа должна хранить информацию о пользователе, осуществляющем торговлю.
   В открытом доступе не удалось узнать какую информацию хранит биржа о пользователе. Но исходя из регистрации сделаем такое предположение:  
   |id пользователя|ФИО|Адрес|Телефон|Адрес электронной почты|Серия и номер паспорта|
   |---------------|---|-----|-------|-----------------------|----------------------|
   |INT            |CHAR(100)|CHAR(300)|(CHAR(14)|CHAR(40)|CHAR(11)|
   |4 байта        |100 байт|300 байт|14 байт|40 байт|11 байт|  
   
   Размер информации о пользователе: ```465 байт```.
   
   Также биржа должна хранить историю торгов одного пользователя.  
Примерный вид одного ордера:  

|id ордера|id пользователя|Пара|Тип ордера (buy или sell)|Тип ордера(LIMIT, MARKET..)|Количество|Время|Цена|Стоп цена|Статус|
|---------|---------------|----|-------------------------|---------------------------|----------|-----|----|---------|------|
|BIGINT      |INT         |INT    |ENUM                  | ENUM                      |FLOAT64   |DATE |FLOAT64|FLOAT64|ENUM|
|8 байт  |4 байта         |4 байта|4 байта               | 4 байта                   | 8 байт  |8 байт|8 байт |8 байт|4 байта|
  
В итоге размер одной сделки в байтах составляет ```60 байт```.

Оценим примерно сколько в среднем сделок хранится у одного пользователя:  
На бирже можно получить историю торгов с 2009 года. Посмотрим на количество пользователей в эти года.  
  
![image](https://user-images.githubusercontent.com/77728314/167309682-30297b57-6744-4b3a-b73f-62fc8c837e88.png)
  
Предположим, что количество пользователей росло пропорционально количеству сделок (подобную закономерность косвенно подтвердили выше).  
Тогда ```16 000 000 / 3 400 000 = 417 000 / x, где x - ежедневное количество сделок, совершаемыми пользователями за 2009 год; x =  142 500```  
Подобным образом вычислим "x" для каждого года, начиная с 2009:  
|2009|2010|2011|2012|2013|2014|2015|2016|2017|2018|2019|2020|2021|
|----|----|----|----|----|----|----|----|----|----|----|----|----|
|142 500|151 700|164 000|171 000|187 000|200 000|214 000|234 000|278 000|415 500|652 000|1 700 000|3 400 000|  

Просуммируем полученные значения и умножим на среднее количество рабочих дней в году(247). 
Общее количество сделок на бирже с 2009 года: ```1 953 695 900```.  
В среднем размер хранилища одного пользователя: ``` 1 953 695 900 / 16 779 069 * 60байт + 465байт = ~7,27 Кб.```

### 2.2 Технические метрики.   
   **2.2.1 Размер хранения в разбивки по типам данных**  
   \\TODO: тут крч количество аккаунтов берется оттуда же откуда и количество уникальных пользователей в п.1, надо указать
   Информция о пользователях: ```465 байт * 27 657 626 = 12 860 796 090 байт = 11,98 Гб``` 
   Информация о сделках пользователя: ```60 байт * 1 953 695 900 = 109,17 Гб``` 
## Источники информации. 
1. https://bcs-express.ru/novosti-i-analitika/top-10-mirovykh-birzh
2. https://www.moex.com/ru/members.aspx?tid=1179&sby=4
3. https://vc.ru/tinkoff_invest/216367-tinkoff-investicii-sostavili-portret-rossiyskogo-investora-2020
4. https://www.similarweb.com/ru/website/binance.com/#overview
5. https://www.moex.com/ru/listing/securities.aspx
